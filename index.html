<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Verification App</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        body { font-family: Arial, sans-serif; background-color: #f3f4f6; color: #333; }
        .container { max-width: 600px; margin: 0 auto; padding: 20px; }
        .error { color: red; font-weight: bold; }
        .success { color: green; font-weight: bold; }
        .hidden { display: none; }
        .btn { transition: background-color 0.3s; }
        .btn:hover { opacity: 0.9; }
        select { color: #333; }
        @media (max-width: 640px) {
            .container { padding: 10px; }
            input, button, select { font-size: 16px; }
        }
        body.dark { background-color: #333; color: #f3f4f6; }
        body.dark .container { background-color: #444; }
        body.dark .btn { background-color: #555; }
        body.dark .error { color: #ff6666; }
        body.dark .success { color: #66ff66; }
        body.dark select { color: #f3f4f6; background-color: #555; }
        body.dark input { background-color: #555; color: #f3f4f6; border-color: #666; }
    </style>
</head>
<body>
    <div class="container bg-white rounded-lg shadow-lg p-6">
        <div id="screen1" class="screen">
            <h2 class="text-2xl font-bold mb-4 text-center" data-translate="enterTelegramId">Enter Telegram ID</h2>
            <input id="telegramId" type="text" placeholder="Your Telegram ID" class="w-full p-2 mb-4 border rounded">
            <button onclick="submitTelegramId()" class="w-full bg-blue-500 text-white p-2 rounded btn" data-translate="submit">Submit</button>
            <div id="codeInput" class="hidden mt-4">
                <p class="mb-2" data-translate="enterCode">Enter the 6-digit code sent to your Telegram:</p>
                <input id="verificationCode" type="text" placeholder="6-digit code" maxlength="6" class="w-full p-2 mb-4 border rounded">
                <button onclick="verifyCode()" class="w-full bg-blue-500 text-white p-2 rounded btn" data-translate="verify">Verify</button>
            </div>
            <p id="error1" class="error hidden mt-2"></p>
        </div>

        <div id="screen2" class="screen hidden">
            <h2 class="text-2xl font-bold mb-4 text-center" data-translate="subscribeToChannels">Subscribe to Channels</h2>
            <p id="subscriptionMessage" class="mb-4 text-center" data-translate="pleaseSubscribe">Please subscribe to the following channels:</p>
            <a href="https://t.me/NickNaymes2Bot" target="_blank" class="block bg-blue-500 text-white p-2 mb-2 rounded text-center btn" data-translate="subscribeToNickNaymes2Bot">Subscribe to @NickNaymes2Bot</a>
            <a href="https://t.me/messagesibotnews" target="_blank" class="block bg-blue-500 text-white p-2 mb-4 rounded text-center btn" data-translate="subscribeToMessagesibotnews">Subscribe to @messagesibotnews</a>
            <button onclick="checkSubscriptions()" class="w-full bg-green-500 text-white p-2 rounded btn" data-translate="checkSubscription">Check Subscription</button>
            <p id="error2" class="error hidden mt-2"></p>
        </div>

        <div id="screen3" class="screen hidden">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold" data-translate="mainMenu">Main Menu</h2>
                <button onclick="showSettings()" class="bg-gray-500 text-white p-2 rounded btn" data-translate="settings">Settings</button>
            </div>
            <p class="mb-4 text-center">
                <span data-translate="currentLimits">Current Limits: </span>
                <span id="limitCount">0</span>
            </p>
            <button onclick="startProcess()" class="w-full bg-blue-500 text-white p-2 mb-2 rounded btn" data-translate="start">Start</button>
            <button onclick="showPromoScreen()" class="w-full bg-purple-500 text-white p-2 rounded btn" data-translate="topUpLimits">Top Up Limits</button>
        </div>

        <div id="usernameScreen" class="screen hidden">
            <h2 class="text-2xl font-bold mb-4 text-center" data-translate="enterUsername">Enter Username</h2>
            <input id="usernameInput" type="text" placeholder="@username" class="w-full p-2 mb-4 border rounded">
            <button onclick="submitUsername()" class="w-full bg-blue-500 text-white p-2 mb-2 rounded btn" data-translate="next">Next</button>
            <button onclick="backToMain()" class="w-full bg-gray-500 text-white p-2 rounded btn" data-translate="back">Back</button>
            <p id="errorUsername" class="error hidden mt-2"></p>
        </div>

        <div id="genderScreen" class="screen hidden">
            <h2 class="text-2xl font-bold mb-4 text-center" data-translate="selectGender">Select Gender of <span id="usernameDisplay"></span></h2>
            <button onclick="selectGender('male')" class="w-full bg-blue-500 text-white p-2 mb-2 rounded btn" data-translate="male">Male</button>
            <button onclick="selectGender('female')" class="w-full bg-pink-500 text-white p-2 mb-2 rounded btn" data-translate="female">Female</button>
            <button onclick="backToUsername()" class="w-full bg-gray-500 text-white p-2 rounded btn" data-translate="back">Back</button>
        </div>

        <div id="loadingScreen" class="screen hidden">
            <h2 id="loadingText" class="text-2xl font-bold mb-4 text-center" data-translate="loading">Loading...</h2>
        </div>

        <div id="chatScreen" class="screen hidden">
            <h2 class="text-2xl font-bold mb-4 text-center" data-translate="selectChat">Select Chat</h2>
            <div id="chatButtons" class="mb-4"></div>
            <button onclick="backToMain()" class="w-full bg-blue-500 text-white p-2 rounded btn" data-translate="mainMenu">Main Menu</button>
        </div>

        <div id="fakeChatScreen" class="screen hidden">
            <h2 class="text-2xl font-bold mb-4 text-center" data-translate="fakeChat">Chat</h2>
            <div id="fakeChatContent" class="mb-4 p-4 border rounded"></div>
            <button onclick="backToChats()" class="w-full bg-gray-500 text-white p-2 mb-2 rounded btn" data-translate="back">Back</button>
            <button onclick="backToMain()" class="w-full bg-blue-500 text-white p-2 rounded btn" data-translate="mainMenu">Main Menu</button>
        </div>

        <div id="promoScreen" class="screen hidden">
            <h2 class="text-2xl font-bold mb-4 text-center" data-translate="enterPromoCode">Enter Promo Code</h2>
            <input id="promoCode" type="text" placeholder="..." class="w-full p-2 mb-4 border rounded">
            <h4 class="mb-4 text-center">
                <a href="https://t.me/Clickerstart_bot" target="_blank" class="text-blue-500" data-translate="buyPromoCodes">Promo codes can be purchased at @Clickerstart_bot</a>
            </h4>
            <button onclick="submitPromoCode()" class="w-full bg-blue-500 text-white p-2 mb-2 rounded btn" data-translate="submit">Submit</button>
            <button onclick="backToMain()" class="w-full bg-gray-500 text-white p-2 rounded btn" data-translate="mainMenu">Main Menu</button>
            <p id="promoMessage" class="mt-2"></p>
        </div>

        <div id="noLimitsScreen" class="screen hidden">
            <h2 class="text-2xl font-bold mb-4 text-center" data-translate="noLimitsAvailable">No Limits Available</h2>
            <p class="mb-4 text-center" data-translate="pleaseTopUp">You have no limits left. Please top up.</p>
            <button onclick="backToMain()" class="w-full bg-gray-500 text-white p-2 rounded btn" data-translate="backToMainMenu">Back to Main Menu</button>
        </div>

        <div id="settingsScreen" class="screen hidden">
            <h2 class="text-2xl font-bold mb-4 text-center" data-translate="settings">Settings</h2>
            <div class="mb-4">
                <label class="block mb-2" data-translate="theme">Theme:</label>
                <select id="themeSelect" class="w-full p-2 border rounded">
                    <option value="light" data-translate="light">Light</option>
                    <option value="dark" data-translate="dark">Dark</option>
                </select>
            </div>
            <div class="mb-4">
                <label class="block mb-2" data-translate="language">Language:</label>
                <select id="languageSelect" class="w-full p-2 border rounded">
                    <option value="en" data-translate="english">English</option>
                    <option value="ru" data-translate="russian">Русский</option>
                </select>
            </div>
            <button onclick="applySettings()" class="w-full bg-blue-500 text-white p-2 mb-2 rounded btn" data-translate="apply">Apply</button>
            <button onclick="backToMain()" class="w-full bg-gray-500 text-white p-2 rounded btn" data-translate="back">Back</button>
        </div>
    </div>

    <script>
        const BOT_TOKEN = '7511624014:AAG9f_M4x9T8CQht5pT5zAu8e_5fRUao7m4';
        const CHANNELS = ['@NickNaymes2Bot', '@messagesibotnews'];
        const CHAT_OPTIONS = ['mom', 'dad', 'brother', 'sister', 'lovedOne'];

        const PROMO_CODES = [
            { code: 'TEST123',           limits: 1 },
            { code: 'HGJKL89',           limits: 3 },
            { code: 'IAMTOP',            limits: 4 },
            { code: 'MYNEWYEAR',         limits: 5 },
            { code: 'READERBOT22ARE23',  limits: 8 },
            { code: 'B7J3V9',            limits: 11 },
            { code: 'XQ4D8',             limits: 12 },
            { code: 'K9V7YPZ6',          limits: 13 },
            { code: 'JZ2R',              limits: 14 },
            { code: 'F6B3V1H8L7M9Z0P',   limits: 18 },
            { code: 'R9J3K2B8C4D1L6X7T', limits: 20 },
            { code: 'Q0T2X7M6P1A3D5V9L', limits: 22 },
            { code: 'S3A8Z9F1B7K0V2J6Y', limits: 24 },
            { code: 'M6W1V8P9G2N3A4L0T', limits: 28 },
            { code: 'C4D1Q9A6B7V5N2LZ',  limits: 30 },
            { code: 'L3T7X2B0J8Q1H9ZK',  limits: 33 },
            { code: 'P2S9X5F1V3R8K0YJ',  limits: 34 },
            { code: 'M6W1V8P9G2N3A4L0T', limits: 37 },
            { code: 'T4B3I7Q0S9F1V2R6X', limits: 40 },
            { code: 'N4M7T9L8G5P1R3W2V', limits: 50 },



            { code: 'Z3A7B1K',          limits: 1 },
            { code: 'N6D4J2M9',         limits: 3 },
            { code: 'P0L9G8I',          limits: 4 },
            { code: 'V1Y3U5O',          limits: 5 },
            { code: 'W7T2D4F3G9J1',     limits: 8 },
            { code: 'A2Q9V7Z',          limits: 11 },
            { code: 'H4J1X3M',          limits: 12 },
            { code: 'K8V0P2Y6S',        limits: 13 },
            { code: 'B9Z1R4',           limits: 14 },
            { code: 'Y6L2T5F9D0N3P',    limits: 18 },
            { code: 'U1C8J7W5L9B4Z0T',  limits: 20 },
            { code: 'Q9V2X3T5J7P0L1N8', limits: 22 },
            { code: 'C6W3V7B5F1Y9Z0T',  limits: 24 },
            { code: 'R4M2P8G1N9A3K0L',  limits: 28 },
            { code: 'X5S1V7B9N0P4L2K',  limits: 30 },
            { code: 'W3T0X2F1J9Y8M7K',  limits: 33 },
            { code: 'T7V0R4K2S1P8Y5J',  limits: 34 },
            { code: 'P3S0M2A6T7L1N8V',  limits: 37 },
            { code: 'F9R4T2X3S1V0I7B',  limits: 40 },
            { code: 'Z8N2L3T0V7P5R1W',  limits: 50 },



            { code: 'R8V1Z0',          limits: 1 },
            { code: 'D4K2J7L',         limits: 3 },
            { code: 'U5B9A2T',         limits: 4 },
            { code: 'Q1S3M7P',         limits: 5 },
            { code: 'F6V4W2G8Z1P',     limits: 8 },
            { code: 'N9L7R2X',         limits: 11 },
            { code: 'H3T0Y8J',         limits: 12 },
            { code: 'L4Z9M1V6',        limits: 13 },
            { code: 'P2C5K0R',         limits: 14 },
            { code: 'T7J9F0A3Y8L1N',   limits: 18 },
            { code: 'B5C6V7K9L1P0R',   limits: 20 },
            { code: 'M3X1Y2F9N5T8V0J', limits: 22 },
            { code: 'S4W8V7B2T1R6L0Z', limits: 24 },
            { code: 'P1A6G9L7F2X0T4N', limits: 28 },
            { code: 'C9R2M5N8Y4P3V7B', limits: 30 },
            { code: 'K6V1X3W9J2Y8L0R', limits: 33 },
            { code: 'S7T4V0Y2P1K9R6X', limits: 34 },
            { code: 'L5B9S3M2T0R8V1N', limits: 37 },
            { code: 'J2X9R4T5S0V7P1F', limits: 40 },
            { code: 'N4T8L1P3V9G7W0R', limits: 50 }
        ];

        let userData = JSON.parse(localStorage.getItem('userData')) || {
            telegramId: null,
            verified: false,
            limits: 1,
            usedUsernames: [],
            usedPromoCodes: [],
            theme: 'light',
            language: 'en',
            selectedChatOptions: null,
            chatMessages: {}
        };
        
        if (typeof userData.limits !== 'number' || userData.limits < 0) {
            userData.limits = 0;
        }
        
        const translations = {
            en: {
                enterTelegramId: 'Enter Telegram ID',
                submit: 'Submit',
                enterCode: 'Enter the 6-digit code sent to your Telegram:',
                verify: 'Verify',
                subscribeToChannels: 'Subscribe to Channels',
                pleaseSubscribe: 'Please subscribe to the following channels:',
                subscribeToNickNaymes2Bot: 'Subscribe to @NickNaymes2Bot',
                subscribeToMessagesibotnews: 'Subscribe to @messagesibotnews',
                checkSubscription: 'Check Subscription',
                mainMenu: 'Main Menu',
                settings: 'Settings',
                currentLimits: 'Current Limits: ',
                start: 'Start',
                topUpLimits: 'Top Up Limits',
                enterUsername: 'Enter Username',
                next: 'Next',
                back: 'Back',
                selectGender: 'Select Gender of ',
                male: 'Male',
                female: 'Female',
                loading: 'Loading...',
                selectChat: 'Select Chat',
                fakeChat: 'The correspondence that I managed to find and translate into English:',
                enterPromoCode: 'Enter Promo Code',
                buyPromoCodes: 'Promo codes can be purchased at @Clickerstart_bot',
                noLimitsAvailable: 'No Limits Available',
                pleaseTopUp: 'You have no limits left. Please top up.',
                backToMainMenu: 'Back to Main Menu',
                theme: 'Theme',
                language: 'Language',
                light: 'Light',
                dark: 'Dark',
                english: 'English',
                russian: 'Russian',
                apply: 'Apply',
                invalidUsername: 'Please enter a valid username starting with @',
                usernameAlreadyUsed: 'This username has already been checked',
                invalidCode: 'Invalid code',
                invalidPromoCode: 'Invalid promo code!',
                promoCodeAlreadyUsed: 'This promo code has already been used!',
                success: 'Success!',
                mom: 'Mom',
                dad: 'Dad',
                brother: 'Brother',
                sister: 'Sister',
                lovedOne: 'Loved One',
                lovedOneMale: 'Beloved',
                lovedOneFemale: 'Beloved',
                chatMessages: [
                    'Hi {chatType}, how are you?',
                    'Hi! I\'m fine, and you?',
                    'I\'m fine too, decided to write!',
                    'Cool, let\'s chat!',
                    'What are your plans for the weekend?',
                    'Maybe I\'ll hang out with friends, and you?',
                    'Me too, thinking of going to the beach.',
                    'Sounds great!',
                    'Yeah, looking forward to it.',
                    'Tell me how it went later!'
                ],
                youCantCheckSamePerson: 'You can\'t check the same person multiple times!'
            },
            ru: {
                enterTelegramId: 'Введите ID Telegram',
                submit: 'Отправить',
                enterCode: 'Введите 6-значный код, отправленный в ваш Telegram:',
                verify: 'Проверить',
                subscribeToChannels: 'Подпишитесь на каналы',
                pleaseSubscribe: 'Пожалуйста, подпишитесь на следующие каналы:',
                subscribeToNickNaymes2Bot: 'Подписаться на @NickNaymes2Bot',
                subscribeToMessagesibotnews: 'Подписаться на @messagesibotnews',
                checkSubscription: 'Проверить подписку',
                mainMenu: 'Главное меню',
                settings: 'Настройки',
                currentLimits: 'Текущие лимиты: ',
                start: 'Начать',
                topUpLimits: 'Пополнить лимиты',
                enterUsername: 'Введите имя пользователя',
                next: 'Далее',
                back: 'Назад',
                selectGender: 'Выберите пол ',
                male: 'Мужской',
                female: 'Женский',
                loading: 'Загрузка...',
                selectChat: 'Выберите чат',
                fakeChat: 'Переписка, которую мне удалось найти и перевести на русский:',
                enterPromoCode: 'Введите промокод',
                buyPromoCodes: 'Промокоды можно приобрести у @Clickerstart_bot',
                noLimitsAvailable: 'Лимиты недоступны',
                pleaseTopUp: 'У вас не осталось лимитов. Пожалуйста, пополните.',
                backToMainMenu: 'Вернуться в главное меню',
                theme: 'Тема',
                language: 'Язык',
                light: 'Светлая',
                dark: 'Темная',
                english: 'Английский',
                russian: 'Русский',
                apply: 'Применить',
                invalidUsername: 'Пожалуйста, введите действительное имя пользователя, начинающееся с @',
                usernameAlreadyUsed: 'Это имя пользователя уже было проверено',
                invalidCode: 'Неверный код',
                invalidPromoCode: 'Неверный промокод!',
                promoCodeAlreadyUsed: 'Этот промокод уже был использован!',
                success: 'Успех!',
                mom: 'Мама',
                dad: 'Папа',
                brother: 'Брат',
                sister: 'Сестра',
                lovedOne: 'Любимый человек',
                lovedOneMale: 'Любимая',
                lovedOneFemale: 'Любимый',
                chatMessages: [
                    'Привет, {chatType}, как дела?',
                    'Привет! У меня все хорошо, а у тебя?',
                    'У меня тоже, решил написать!',
                    'Круто, давай поболтаем!',
                    'Какие у тебя планы на выходные?',
                    'Может, потусуюсь с друзьями, а ты?',
                    'Я тоже, думаю сходить на пляж.',
                    'Звучит здорово!',
                    'Да, жду с нетерпением.',
                    'Расскажи потом, как прошло!'
                ],
                youCantCheckSamePerson: 'Нельзя проверять одного и того же человека несколько раз!'
            }
        };

        function saveData() {
            localStorage.setItem('userData', JSON.stringify(userData));
        }

        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => screen.classList.add('hidden'));
            document.getElementById(screenId).classList.remove('hidden');
            translatePage();
            updateLimitsDisplay();
        }

        function showError(elementId, message) {
            const errorElement = document.getElementById(elementId);
            errorElement.textContent = message;
            errorElement.classList.remove('hidden');
        }

        function clearError(elementId) {
            const errorElement = document.getElementById(elementId);
            errorElement.textContent = '';
            errorElement.classList.add('hidden');
        }

        function updateLimitsDisplay() {
            const limitCountElement = document.getElementById('limitCount');
            if (limitCountElement) {
                limitCountElement.textContent = userData.limits;
            }
        }

        async function submitTelegramId() {
            const telegramId = document.getElementById('telegramId').value.trim();
            if (!telegramId) {
                showError('error1', translations[userData.language].enterTelegramId || 'Please enter a Telegram ID');
                return;
            }

            clearError('error1');
            userData.telegramId = telegramId;
            saveData();

            try {
                const code = Math.floor(100000 + Math.random() * 900000);
                const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        chat_id: telegramId,
                        text: `Your verification code is: ${code}`
                    })
                });

                const result = await response.json();
                if (result.ok) {
                    userData.verificationCode = code;
                    saveData();
                    document.getElementById('codeInput').classList.remove('hidden');
                } else {
                    userData.verified = true;
                    saveData();
                    checkSubscriptions(true);
                }
            } catch (error) {
                userData.verified = true;
                saveData();
                checkSubscriptions(true);
            }
        }

        function verifyCode() {
            const code = document.getElementById('verificationCode').value.trim();
            if (code === userData.verificationCode.toString()) {
                userData.verified = true;
                saveData();
                checkSubscriptions(true);
            } else {
                showError('error1', translations[userData.language].invalidCode);
            }
        }

        async function checkSubscriptions(autoProceed = false) {
            let allSubscribed = true;
            for (const channel of CHANNELS) {
                try {
                    const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/getChatMember?chat_id=${channel}&user_id=${userData.telegramId}`);
                    const result = await response.json();
                    if (!result.ok || !['member', 'administrator', 'creator'].includes(result.result.status)) {
                        allSubscribed = false;
                        break;
                    }
                } catch (error) {
                    allSubscribed = false;
                    break;
                }
            }

            if (allSubscribed) {
                showScreen('screen3');
            } else {
                showScreen('screen2');
                if (!autoProceed) {
                    showError('error2', translations[userData.language].pleaseSubscribe);
                }
            }
        }

        function startProcess() {
            checkSubscriptions().then(() => {
                if (document.getElementById('screen3').classList.contains('hidden')) return;
                if (userData.limits <= 0) {
                    showScreen('noLimitsScreen');
                } else {
                    const options = [...CHAT_OPTIONS];
                    userData.selectedChatOptions = options.sort(() => Math.random() - 0.5).slice(0, Math.floor(Math.random() * options.length) + 1);
                    saveData();
                    showScreen('usernameScreen');
                }
            });
        }

        function submitUsername() {
            const username = document.getElementById('usernameInput').value.trim();
            if (!username.startsWith('@') || username.length < 2) {
                showError('errorUsername', translations[userData.language].invalidUsername);
                return;
            }
            if (userData.usedUsernames.includes(username)) {
                showError('errorUsername', translations[userData.language].youCantCheckSamePerson);
                return;
            }
            clearError('errorUsername');
            userData.currentUsername = username;
            userData.usedUsernames.push(username);
            saveData();
            showScreen('genderScreen');
            const usernameDisplay = document.getElementById('usernameDisplay');
            if (usernameDisplay) {
                usernameDisplay.textContent = username;
            } else {
                console.error('Element with id "usernameDisplay" not found');
            }
        }

        function selectGender(gender) {
            userData.currentGender = gender;
            saveData();
            showLoadingScreen();
        }

        function showLoadingScreen() {
            if (userData.limits > 0) {
                userData.limits -= 1;
                saveData();
                updateLimitsDisplay();
            } else {
                showScreen('noLimitsScreen');
                return;
            }
            showScreen('loadingScreen');
            const loadingText = document.getElementById('loadingText');
            loadingText.textContent = translations[userData.language].loading;
            setTimeout(() => {
                showChatScreen();
            }, 3000);
        }

        function showChatScreen() {
            showScreen('chatScreen');
            const chatButtons = document.getElementById('chatButtons');
            chatButtons.innerHTML = '';
            let options = [...userData.selectedChatOptions];
            if (userData.currentGender === 'male') {
                options = options.map(opt => opt === 'lovedOne' ? 'lovedOneMale' : opt);
            } else if (userData.currentGender === 'female') {
                options = options.map(opt => opt === 'lovedOne' ? 'lovedOneFemale' : opt);
            }
            for (const option of options) {
                const button = document.createElement('button');
                button.className = 'w-full bg-blue-500 text-white p-2 mb-2 rounded btn';
                button.textContent = translations[userData.language][option] || option;
                button.onclick = () => showFakeChat(option);
                chatButtons.appendChild(button);
            }
        }

        function showFakeChat(chatType) {
            showScreen('fakeChatScreen');
            const content = document.getElementById('fakeChatContent');
            let messages = userData.chatMessages[chatType];
            if (!messages) {
                messages = generateFakeMessages(chatType);
                userData.chatMessages[chatType] = messages;
                saveData();
            }
            content.innerHTML = messages.map(msg => `<p><strong>${msg.sender}:</strong> ${msg.text}</p>`).join('');
        }

        function generateFakeMessages(chatType) {
            const messages = translations[userData.language].chatMessages.map((text, index) => {
                if (index % 2 === 0) {
                    return { sender: userData.currentUsername || 'You', text: text.replace('{chatType}', translations[userData.language][chatType] || chatType) };
                } else {
                    return { sender: translations[userData.language][chatType] || chatType, text: text };
                }
            });
            const messageCount = Math.floor(Math.random() * 5) + 3;
            return messages.slice(0, messageCount);
        }

        function showPromoScreen() {
            showScreen('promoScreen');
            document.getElementById('promoCode').value = '';
            document.getElementById('promoMessage').textContent = '';
        }

        function submitPromoCode() {
            const promoCode = document.getElementById('promoCode').value.trim();
            const messageElement = document.getElementById('promoMessage');
            if (!promoCode) {
                messageElement.className = 'error';
                messageElement.textContent = translations[userData.language].invalidPromoCode;
                return;
            }
            if (userData.usedPromoCodes.includes(promoCode)) {
                messageElement.className = 'error';
                messageElement.textContent = translations[userData.language].promoCodeAlreadyUsed;
                return;
            }
            const promo = PROMO_CODES.find(p => p.code === promoCode);
            if (promo) {
                userData.limits += promo.limits;
                userData.usedPromoCodes.push(promoCode);
                saveData();
                updateLimitsDisplay();
                messageElement.className = 'success';
                messageElement.textContent = translations[userData.language].success;
                document.getElementById('promoCode').value = '';
            } else {
                messageElement.className = 'error';
                messageElement.textContent = translations[userData.language].invalidPromoCode;
            }
        }

        function backToMain() {
            showScreen('screen3');
            userData.currentUsername = null;
            userData.currentGender = null;
            userData.selectedChatOptions = null;
            userData.chatMessages = {};
            CHAT_OPTIONS.forEach(chatType => {
                userData.chatMessages[chatType] = generateFakeMessages(chatType);
            });
            saveData();
        }

        function backToUsername() {
            showScreen('usernameScreen');
        }

        function backToChats() {
            showChatScreen();
        }

        function showSettings() {
            showScreen('settingsScreen');
            document.getElementById('themeSelect').value = userData.theme;
            document.getElementById('languageSelect').value = userData.language;
        }

        function applySettings() {
            userData.theme = document.getElementById('themeSelect').value;
            userData.language = document.getElementById('languageSelect').value;
            saveData();
            applyTheme();
            translatePage();
            backToMain();
        }

        function applyTheme() {
            if (userData.theme === 'dark') {
                document.body.classList.add('dark');
            } else {
                document.body.classList.remove('dark');
            }
        }

        function translatePage() {
            const elements = document.querySelectorAll('[data-translate]');
            elements.forEach(element => {
                const key = element.getAttribute('data-translate');
                element.textContent = translations[userData.language][key];
                if (key === 'selectGender' && userData.currentUsername) {
                    element.textContent += userData.currentUsername;
                }
            });
            updateLimitsDisplay();
        }

        function initialize() {
            applyTheme();
            translatePage();
            if (userData.telegramId && userData.verified) {
                checkSubscriptions(true);
            } else {
                showScreen('screen1');
            }
        }

        initialize();
    </script>
</body>
</html>
